@let events = (events$ | async);
@let standings = (standings$ | async);
<div class="md:mx-20">
  <h1 class="flex justify-center text-3xl py-5">
    {{ this.year }} {{ this.category }} {{ 'standings.title' | translate }}
  </h1>

  <app-local-loading-indicator [loading]="loading()" />

  @if (!loading()) {
    @if (standings && standings.length > 0) {
      <div class="overflow-x-auto rounded-lg shadow max-h-[calc(100vh-225px)] md:max-h-[calc(100vh-250px)]">
        <table class="min-w-full divide-y divide-gray-200 table-fixed">
          <thead class="bg-gray-50 sticky top-0 z-20">
            <tr>
              <th scope="col" class="px-2 py-2 justify-center text-xs font-medium text-gray-900 uppercase tracking-wider sticky left-0 bg-gray-50 z-10">{{ 'standings.place' | translate }}</th>
              <th scope="col" class="whitespace-nowrap px-2 py-2 text-left text-xs font-medium text-gray-800 uppercase tracking-wider sticky left-[4.6em] bg-gray-50 z-10 w-50">{{ 'standings.player' | translate }}</th>
              <th scope="col" class="whitespace-nowrap px-2 py-2 text-left text-xs font-medium text-gray-800 uppercase tracking-wider">{{ 'standings.license' | translate }}</th>
              <th scope="col" class="whitespace-nowrap justify-center px-2 py-2 text-xs font-medium text-gray-800 uppercase tracking-wider">{{ 'standings.total' | translate }}</th>
              @for (event of events; track event.id) {
                <th
                scope="col"
                class="whitespace-nowrap px-2 py-3 justify-center text-xs font-medium text-gray-400 uppercase tracking-wider hover:underline">
                  <a
                    [href]="'https://www.pdga.com/tour/event/' + event.eventId + '#' + category"
                    target="_blank"
                    rel="noopener noreferrer"
                  >
                    {{ event.displayName }}
                  </a>
                </th>
              }
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            @for (standing of standings; track $index) {
            <tr>
              <td class="px-2 py-2 whitespace-nowrap text-sm text-gray-900 text-center sticky left-0 bg-white z-10">{{ standing.rank }}</td>
              <td
                class="px-2 py-2 whitespace-nowrap text-sm text-gray-800 hover:text-blue-700 cursor-pointer sticky left-[3.92em] bg-white z-10"
                (click)="this.router.navigate(['/player', standing.playerId!])"
                >{{ findPlayer(standing.playerId!).firstname }} {{ findPlayer(standing.playerId!).lastname }}</td>
              <td class="px-2 py-2 whitespace-nowrap text-sm text-gray-800">SUI.{{ findPlayer(standing.playerId!).sdaNumber }}</td>
              <td class="px-2 py-2 whitespace-nowrap text-sm text-gray-800 flex justify-center">{{ standing.totalPoints | number:'1.0-0'}}</td>
              @for (event of events; track event.eventId!) {
                @if (hasEventId(standing, event.eventId!)) {
                  <td class="px-2 py-2 whitespace-nowrap text-sm text-gray-400 text-center"
                    [style.text-decoration]="isEventIncluded(standing, event.eventId!) ? '' : 'line-through'">
                    {{ getEventPoints(standing, event.eventId!) != 0 ?  (getEventPoints(standing, event.eventId!) | number:'1.0-0') : ('standings.dnf' | translate) }}
                  </td>
                } @else {
                  <td></td>
                }
              }
            </tr>
            }
          </tbody>
        </table>
      </div>
    } @else {
      <p class="text-center text-xl py-2">{{ 'standings.noStandings' | translate: { category: category } }}</p>
    }
  }
</div>
